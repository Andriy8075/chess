// upgrade code
// code style
// speed optimization in checkAfterMove if king doesn't moves